'use strict';

angular.module('bookStore.controllers', [])
.controller('StoreController', ['$scope','$location', function($scope, $location) {
	$scope.user = "Interesting Person";
	
	$scope.inventory = function (){
		$location.path("inventory");
	}
	
}]).controller('InventoryController', ['$scope','$location','Inventory', function($scope, $location,Inventory) {
	Inventory.list(function (data){
		$scope.books = data;
	});
	$scope.home = function (){
		$location.path("");
	}
	$scope.tableParams = new ngTableParams({
        page: 1,            // show first page
        count: 10,          // count per page
        sorting: {
            name: 'asc'     // initial sorting
        }
    }, {
        total: data.length, // length of data
        getData: function($defer, params) {
            // use build-in angular filter
            var orderedData = params.sorting() ?
                                $filter('orderBy')(data, params.orderBy()) :
                                data;

            $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));
        }
    });
}]);

angular.module('bookStore', [ 'ngRoute','bookStore.services','bookStore.controllers','ngResource' ,'ngTable']).config(
		[ '$routeProvider', function($routeProvider) {
			$routeProvider.when('/inventory',{
				templateUrl : 'inventory/inventoryFragment',
				controller: 'InventoryController'
			});
			$routeProvider.otherwise({
				templateUrl : 'store/welcome',
				controller: 'StoreController'
			});
		} ]);

/* Services */
var services = angular.module('bookStore.services', ['ngResource']);

services.factory('Inventory', ['$resource', function ($resource){
	return $resource('inventory/list',{},{
		list: {
			method: 'GET',
			isArray: true
		}
	});
}]);